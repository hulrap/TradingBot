"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},9563:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},6347:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>x,originalPathname:()=>y,patchFetch:()=>S,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>E,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>v});var s={};r.r(s),r.d(s,{DELETE:()=>p,POST:()=>m});var i=r(5649),a=r(8584),n=r(5144),o=r(7180),u=r(1304),l=r(1376),c=r(4538),d=r(2812);let h=l.z.object({email:l.z.string().email("Invalid email format").toLowerCase(),password:l.z.string().min(8,"Password must be at least 8 characters long")});async function m(e){try{let t=await d.qQ.check(e,5,9e5);if(!t.success)return o.Z.json({message:"Too many login attempts. Please try again later.",retryAfter:Math.ceil((t.resetTime-Date.now())/1e3)},{status:429});let r=await e.json(),s=h.safeParse(r);if(!s.success)return o.Z.json({message:"Invalid input data",errors:s.error.errors},{status:400});let{email:i,password:a}=s.data,n=function(){let e=process.env.SUPABASE_URL,t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase configuration is missing. Please set SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY environment variables.");return(0,u.eI)(e,t)}(),{data:l,error:m}=await n.from("users").select("id, email, password_hash, created_at, updated_at").eq("email",i).single();if(m||!l)return console.log(`Login attempt failed - user not found: ${i}`),o.Z.json({message:"Invalid credentials"},{status:401});if(!await (0,c.Gv)(a,l.password_hash))return console.log(`Login attempt failed - invalid password: ${i}`),o.Z.json({message:"Invalid credentials"},{status:401});let p={sub:l.id,email:l.email},f=await (0,c.XX)(p,"24h");await n.from("users").update({last_login_at:new Date().toISOString()}).eq("id",l.id);let g={id:l.id,email:l.email,createdAt:l.created_at,updatedAt:l.updated_at};console.log(`Successful login for user: ${i}`);let w=o.Z.json({success:!0,user:g,message:"Login successful"});return w.cookies.set("auth_token",f,{httpOnly:!0,secure:!0,path:"/",sameSite:"strict",maxAge:86400}),w}catch(e){return console.error("Login error:",e),o.Z.json({message:"An internal server error occurred"},{status:500})}}async function p(e){try{console.log("User logout requested");let e=o.Z.json({success:!0,message:"Logout successful"});return e.cookies.set("auth_token","",{httpOnly:!0,secure:!0,path:"/",sameSite:"strict",maxAge:0}),e}catch(e){return console.error("Logout error:",e),o.Z.json({message:"An internal server error occurred"},{status:500})}}let f=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\User1\\Downloads\\TradingBot\\apps\\frontend\\src\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:w,serverHooks:E,headerHooks:x,staticGenerationBailout:v}=f,y="/api/auth/login/route";function S(){return(0,n.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:w})}},2812:(e,t,r)=>{r.d(t,{qQ:()=>i});class s{constructor(e=100,t=9e5){this.store={},this.defaultLimit=e,this.defaultWindow=t,setInterval(()=>{this.cleanup()},3e5)}async check(e,t=this.defaultLimit,r=this.defaultWindow){let s=this.getIdentifier(e),i=Date.now(),a=`${s}:${Math.floor(i/r)}`;this.store[a]||(this.store[a]={count:0,resetTime:i+r});let n=this.store[a];return n.count>=t?{success:!1,remaining:0,resetTime:n.resetTime,error:`Rate limit exceeded. Try again in ${Math.ceil((n.resetTime-i)/1e3)} seconds.`}:(n.count++,{success:!0,remaining:t-n.count,resetTime:n.resetTime})}getIdentifier(e){let t=e.headers.get("x-user-id");if(t)return`user:${t}`;let r=e.headers.get("x-forwarded-for"),s=e.headers.get("x-real-ip"),i=r?r.split(",")[0]?.trim():s||"unknown";return`ip:${i}`}cleanup(){let e=Date.now();Object.keys(this.store).forEach(t=>{let r=this.store[t];r&&r.resetTime<e&&delete this.store[t]})}async checkLimit(e,t="default"){let r="action"===t?10:this.defaultLimit,s=await this.check(e,r);return s.success?{allowed:!0}:{allowed:!1,retryAfter:Math.ceil((s.resetTime-Date.now())/1e3)}}getStatus(e){let t=this.getIdentifier(e),r=Date.now(),s=`${t}:${Math.floor(r/this.defaultWindow)}`,i=this.store[s];return i?{count:i.count,remaining:Math.max(0,this.defaultLimit-i.count),resetTime:i.resetTime}:{count:0,remaining:this.defaultLimit,resetTime:r+this.defaultWindow}}}let i=new s;function a(e=100,t=9e5){return async r=>{let s=await i.check(r,e,t);return{...s,headers:{"X-RateLimit-Limit":e.toString(),"X-RateLimit-Remaining":s.remaining.toString(),"X-RateLimit-Reset":Math.ceil(s.resetTime/1e3).toString()}}}}a(5,9e5),a(100,9e5),a(50,6e4)},4538:(e,t,r)=>{r.d(t,{Gv:()=>m,HI:()=>c,PZ:()=>f,R1:()=>w,XX:()=>p,c_:()=>h,pe:()=>d});var s=r(6113),i=r(8383),a=r(2541),n=r(4627);let o="aes-256-cbc",u=null;function l(){if(u)return u;let e=process.env.MASTER_ENCRYPTION_KEY;if(!e)throw Error("FATAL: MASTER_ENCRYPTION_KEY environment variable is not set.");return u=new Uint8Array((0,s.scryptSync)(e,"salt",32))}function c(e){let t=l(),r=new Uint8Array((0,s.randomBytes)(16)),i=(0,s.createCipheriv)(o,t,r),a=i.update(e,"utf8","hex");return a+=i.final("hex"),`${Buffer.from(r).toString("hex")}:${a}`}function d(e){let t=l(),[r,i]=e.split(":");if(!r||!i)throw Error("Invalid hash format for decryption.");let a=new Uint8Array(Buffer.from(r,"hex")),n=(0,s.createDecipheriv)(o,t,a);return n.update(i,"hex","utf8")+n.final("utf8")}async function h(e){if(!e||e.length<8)throw Error("Password must be at least 8 characters long");return i.vp(e,12)}async function m(e,t){return!!e&&!!t&&i.qu(e,t)}async function p(e,t="24h"){let r=g();return await new a.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(t).sign(r)}async function f(e){let t=g();try{let{payload:r}=await n._(e,t);return r}catch(e){throw Error("Invalid or expired token")}}function g(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET environment variable is not set");if(e.length<32)throw Error("JWT_SECRET must be at least 32 characters long");return new TextEncoder().encode(e)}function w(e=32){return(0,s.randomBytes)(e).toString("hex")}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[807,457],()=>r(6347));module.exports=s})();
"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},6005:e=>{e.exports=require("node:crypto")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},4577:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},5206:e=>{e.exports=require("zlib")},2429:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>q,originalPathname:()=>S,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>L});var s={};r.r(s),r.d(s,{DELETE:()=>h,POST:()=>p});var i=r(5489),a=r(8285),o=r(2377),n=r(1225),u=r(9621),l=r(2571),c=r(9696),d=r(3973);let m=l.z.object({email:l.z.string().email("Invalid email format").toLowerCase(),password:l.z.string().min(8,"Password must be at least 8 characters long")});async function p(e){try{let t=await d.qQ.check(e,5,9e5);if(!t.success)return n.Z.json({message:"Too many login attempts. Please try again later.",retryAfter:Math.ceil((t.resetTime-Date.now())/1e3)},{status:429});let r=await e.json(),s=m.safeParse(r);if(!s.success)return n.Z.json({message:"Invalid input data",errors:s.error.errors},{status:400});let{email:i,password:a}=s.data,o=function(){let e=process.env.SUPABASE_URL,t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase configuration is missing. Please set SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY environment variables.");return(0,u.eI)(e,t)}(),{data:l,error:p}=await o.from("users").select("id, email, password_hash, created_at, updated_at").eq("email",i).single();if(p||!l)return console.log(`Login attempt failed - user not found: ${i}`),n.Z.json({message:"Invalid credentials"},{status:401});if(!await (0,c.Gv)(a,l.password_hash))return console.log(`Login attempt failed - invalid password: ${i}`),n.Z.json({message:"Invalid credentials"},{status:401});let h={sub:l.id,email:l.email},g=await (0,c.XX)(h,"24h");await o.from("users").update({last_login_at:new Date().toISOString()}).eq("id",l.id);let f={id:l.id,email:l.email,createdAt:l.created_at,updatedAt:l.updated_at};console.log(`Successful login for user: ${i}`);let w=n.Z.json({success:!0,user:f,message:"Login successful"});return w.cookies.set("auth_token",g,{httpOnly:!0,secure:!0,path:"/",sameSite:"strict",maxAge:86400}),w}catch(e){return console.error("Login error:",e),n.Z.json({message:"An internal server error occurred"},{status:500})}}async function h(e){try{console.log("User logout requested");let e=n.Z.json({success:!0,message:"Logout successful"});return e.cookies.set("auth_token","",{httpOnly:!0,secure:!0,path:"/",sameSite:"strict",maxAge:0}),e}catch(e){return console.error("Logout error:",e),n.Z.json({message:"An internal server error occurred"},{status:500})}}let g=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\User1\\Downloads\\TradingBot\\apps\\frontend\\src\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:x,headerHooks:q,staticGenerationBailout:L}=g,S="/api/auth/login/route";function v(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:w})}},3973:(e,t,r)=>{r.d(t,{qQ:()=>i});class s{store={};defaultLimit;defaultWindow;constructor(e=100,t=9e5){this.defaultLimit=e,this.defaultWindow=t,setInterval(()=>{this.cleanup()},3e5)}async check(e,t=this.defaultLimit,r=this.defaultWindow){let s=this.getIdentifier(e),i=Date.now(),a=`${s}:${Math.floor(i/r)}`;this.store[a]||(this.store[a]={count:0,resetTime:i+r});let o=this.store[a];return o.count>=t?{success:!1,remaining:0,resetTime:o.resetTime,error:`Rate limit exceeded. Try again in ${Math.ceil((o.resetTime-i)/1e3)} seconds.`}:(o.count++,{success:!0,remaining:t-o.count,resetTime:o.resetTime})}getIdentifier(e){let t=e.headers.get("x-user-id");if(t)return`user:${t}`;let r=e.headers.get("x-forwarded-for"),s=e.headers.get("x-real-ip"),i=r?r.split(",")[0]?.trim():s||"unknown";return`ip:${i}`}cleanup(){let e=Date.now();Object.keys(this.store).forEach(t=>{let r=this.store[t];r&&r.resetTime<e&&delete this.store[t]})}async checkLimit(e,t="default"){let r="action"===t?10:this.defaultLimit,s=await this.check(e,r);return s.success?{allowed:!0}:{allowed:!1,retryAfter:Math.ceil((s.resetTime-Date.now())/1e3)}}getStatus(e){let t=this.getIdentifier(e),r=Date.now(),s=`${t}:${Math.floor(r/this.defaultWindow)}`,i=this.store[s];return i?{count:i.count,remaining:Math.max(0,this.defaultLimit-i.count),resetTime:i.resetTime}:{count:0,remaining:this.defaultLimit,resetTime:r+this.defaultWindow}}}let i=new s;function a(e=100,t=9e5){return async r=>{let s=await i.check(r,e,t);return{...s,headers:{"X-RateLimit-Limit":e.toString(),"X-RateLimit-Remaining":s.remaining.toString(),"X-RateLimit-Reset":Math.ceil(s.resetTime/1e3).toString()}}}}a(5,9e5),a(100,9e5),a(50,6e4)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[308,294,437],()=>r(2429));module.exports=s})();
"use strict";(()=>{var e={};e.id=2,e.ids=[2],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},6005:e=>{e.exports=require("node:crypto")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},4577:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},5206:e=>{e.exports=require("zlib")},6771:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>x,originalPathname:()=>A,patchFetch:()=>q,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>S});var s={};r.r(s),r.d(s,{POST:()=>h});var a=r(5489),i=r(8285),o=r(2377),n=r(1225),u=r(9621),c=r(2571),l=r(9696),d=r(3973);let m=c.z.object({email:c.z.string().email("Invalid email format").toLowerCase().max(254,"Email too long"),password:c.z.string().min(8,"Password must be at least 8 characters long").max(128,"Password too long").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/,"Password must contain at least one uppercase letter, one lowercase letter, one number, and one special character"),confirmPassword:c.z.string()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});async function h(e){try{let t=await d.qQ.check(e,3,36e5);if(!t.success)return n.Z.json({success:!1,message:"Too many registration attempts. Please try again later.",retryAfter:Math.ceil((t.resetTime-Date.now())/1e3)},{status:429});let r=await e.json(),s=m.safeParse(r);if(!s.success)return n.Z.json({success:!1,message:"Invalid input data",errors:s.error.errors},{status:400});let{email:a,password:i}=s.data,o=function(){let e=process.env.SUPABASE_URL,t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase configuration is missing. Please set SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY environment variables.");return(0,u.eI)(e,t)}(),{data:c}=await o.from("users").select("id").eq("email",a).single();if(c)return n.Z.json({success:!1,message:"An account with this email already exists"},{status:409});let h=await (0,l.c_)(i),p=`user_${Date.now()}_${(0,l.R1)(16)}`,{data:g,error:f}=await o.from("users").insert({id:p,email:a,password_hash:h,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select("id, email, created_at, updated_at").single();if(f){if(console.error("User registration error:",f),"23505"===f.code)return n.Z.json({success:!1,message:"An account with this email already exists"},{status:409});return n.Z.json({success:!1,message:"Failed to create user account"},{status:500})}let w={sub:g.id,email:g.email},x=await (0,l.XX)(w,"24h"),S={id:g.id,email:g.email,createdAt:g.created_at,updatedAt:g.updated_at};console.log(`New user registered: ${a}`);let A=n.Z.json({success:!0,user:S,message:"Account created successfully"});return A.cookies.set("auth_token",x,{httpOnly:!0,secure:!0,path:"/",sameSite:"strict",maxAge:86400}),A}catch(e){return console.error("Registration error:",{error:e instanceof Error?e.message:"Unknown error",timestamp:new Date().toISOString()}),n.Z.json({success:!1,message:"An internal server error occurred"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"C:\\Users\\User1\\Downloads\\TradingBot\\apps\\frontend\\src\\app\\api\\auth\\register\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:w,headerHooks:x,staticGenerationBailout:S}=p,A="/api/auth/register/route";function q(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}},3973:(e,t,r)=>{r.d(t,{qQ:()=>a});class s{store={};defaultLimit;defaultWindow;constructor(e=100,t=9e5){this.defaultLimit=e,this.defaultWindow=t,setInterval(()=>{this.cleanup()},3e5)}async check(e,t=this.defaultLimit,r=this.defaultWindow){let s=this.getIdentifier(e),a=Date.now(),i=`${s}:${Math.floor(a/r)}`;this.store[i]||(this.store[i]={count:0,resetTime:a+r});let o=this.store[i];return o.count>=t?{success:!1,remaining:0,resetTime:o.resetTime,error:`Rate limit exceeded. Try again in ${Math.ceil((o.resetTime-a)/1e3)} seconds.`}:(o.count++,{success:!0,remaining:t-o.count,resetTime:o.resetTime})}getIdentifier(e){let t=e.headers.get("x-user-id");if(t)return`user:${t}`;let r=e.headers.get("x-forwarded-for"),s=e.headers.get("x-real-ip"),a=r?r.split(",")[0]?.trim():s||"unknown";return`ip:${a}`}cleanup(){let e=Date.now();Object.keys(this.store).forEach(t=>{let r=this.store[t];r&&r.resetTime<e&&delete this.store[t]})}async checkLimit(e,t="default"){let r="action"===t?10:this.defaultLimit,s=await this.check(e,r);return s.success?{allowed:!0}:{allowed:!1,retryAfter:Math.ceil((s.resetTime-Date.now())/1e3)}}getStatus(e){let t=this.getIdentifier(e),r=Date.now(),s=`${t}:${Math.floor(r/this.defaultWindow)}`,a=this.store[s];return a?{count:a.count,remaining:Math.max(0,this.defaultLimit-a.count),resetTime:a.resetTime}:{count:0,remaining:this.defaultLimit,resetTime:r+this.defaultWindow}}}let a=new s;function i(e=100,t=9e5){return async r=>{let s=await a.check(r,e,t);return{...s,headers:{"X-RateLimit-Limit":e.toString(),"X-RateLimit-Remaining":s.remaining.toString(),"X-RateLimit-Reset":Math.ceil(s.resetTime/1e3).toString()}}}}i(5,9e5),i(100,9e5),i(50,6e4)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[308,294,437],()=>r(6771));module.exports=s})();
"use strict";(()=>{var e={};e.id=2,e.ids=[2],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},9563:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},8466:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>x,originalPathname:()=>S,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>w,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>E});var s={};r.r(s),r.d(s,{POST:()=>m});var a=r(5649),i=r(8584),n=r(5144),o=r(7180),u=r(1304),c=r(1376),l=r(4538),d=r(2812);let h=c.z.object({email:c.z.string().email("Invalid email format").toLowerCase().max(254,"Email too long"),password:c.z.string().min(8,"Password must be at least 8 characters long").max(128,"Password too long").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]/,"Password must contain at least one uppercase letter, one lowercase letter, one number, and one special character"),confirmPassword:c.z.string()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});async function m(e){try{let t=await d.qQ.check(e,3,36e5);if(!t.success)return o.Z.json({success:!1,message:"Too many registration attempts. Please try again later.",retryAfter:Math.ceil((t.resetTime-Date.now())/1e3)},{status:429});let r=await e.json(),s=h.safeParse(r);if(!s.success)return o.Z.json({success:!1,message:"Invalid input data",errors:s.error.errors},{status:400});let{email:a,password:i}=s.data,n=function(){let e=process.env.SUPABASE_URL,t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase configuration is missing. Please set SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY environment variables.");return(0,u.eI)(e,t)}(),{data:c}=await n.from("users").select("id").eq("email",a).single();if(c)return o.Z.json({success:!1,message:"An account with this email already exists"},{status:409});let m=await (0,l.c_)(i),p=`user_${Date.now()}_${(0,l.R1)(16)}`,{data:f,error:g}=await n.from("users").insert({id:p,email:a,password_hash:m,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}).select("id, email, created_at, updated_at").single();if(g){if(console.error("User registration error:",g),"23505"===g.code)return o.Z.json({success:!1,message:"An account with this email already exists"},{status:409});return o.Z.json({success:!1,message:"Failed to create user account"},{status:500})}let w={sub:f.id,email:f.email},x=await (0,l.XX)(w,"24h"),E={id:f.id,email:f.email,createdAt:f.created_at,updatedAt:f.updated_at};console.log(`New user registered: ${a}`);let S=o.Z.json({success:!0,user:E,message:"Account created successfully"});return S.cookies.set("auth_token",x,{httpOnly:!0,secure:!0,path:"/",sameSite:"strict",maxAge:86400}),S}catch(e){return console.error("Registration error:",{error:e instanceof Error?e.message:"Unknown error",timestamp:new Date().toISOString()}),o.Z.json({success:!1,message:"An internal server error occurred"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"C:\\Users\\User1\\Downloads\\TradingBot\\apps\\frontend\\src\\app\\api\\auth\\register\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:w,headerHooks:x,staticGenerationBailout:E}=p,S="/api/auth/register/route";function y(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:g})}},2812:(e,t,r)=>{r.d(t,{qQ:()=>a});class s{constructor(e=100,t=9e5){this.store={},this.defaultLimit=e,this.defaultWindow=t,setInterval(()=>{this.cleanup()},3e5)}async check(e,t=this.defaultLimit,r=this.defaultWindow){let s=this.getIdentifier(e),a=Date.now(),i=`${s}:${Math.floor(a/r)}`;this.store[i]||(this.store[i]={count:0,resetTime:a+r});let n=this.store[i];return n.count>=t?{success:!1,remaining:0,resetTime:n.resetTime,error:`Rate limit exceeded. Try again in ${Math.ceil((n.resetTime-a)/1e3)} seconds.`}:(n.count++,{success:!0,remaining:t-n.count,resetTime:n.resetTime})}getIdentifier(e){let t=e.headers.get("x-user-id");if(t)return`user:${t}`;let r=e.headers.get("x-forwarded-for"),s=e.headers.get("x-real-ip"),a=r?r.split(",")[0]?.trim():s||"unknown";return`ip:${a}`}cleanup(){let e=Date.now();Object.keys(this.store).forEach(t=>{let r=this.store[t];r&&r.resetTime<e&&delete this.store[t]})}async checkLimit(e,t="default"){let r="action"===t?10:this.defaultLimit,s=await this.check(e,r);return s.success?{allowed:!0}:{allowed:!1,retryAfter:Math.ceil((s.resetTime-Date.now())/1e3)}}getStatus(e){let t=this.getIdentifier(e),r=Date.now(),s=`${t}:${Math.floor(r/this.defaultWindow)}`,a=this.store[s];return a?{count:a.count,remaining:Math.max(0,this.defaultLimit-a.count),resetTime:a.resetTime}:{count:0,remaining:this.defaultLimit,resetTime:r+this.defaultWindow}}}let a=new s;function i(e=100,t=9e5){return async r=>{let s=await a.check(r,e,t);return{...s,headers:{"X-RateLimit-Limit":e.toString(),"X-RateLimit-Remaining":s.remaining.toString(),"X-RateLimit-Reset":Math.ceil(s.resetTime/1e3).toString()}}}}i(5,9e5),i(100,9e5),i(50,6e4)},4538:(e,t,r)=>{r.d(t,{Gv:()=>m,HI:()=>l,PZ:()=>f,R1:()=>w,XX:()=>p,c_:()=>h,pe:()=>d});var s=r(6113),a=r(8383),i=r(2541),n=r(4627);let o="aes-256-cbc",u=null;function c(){if(u)return u;let e=process.env.MASTER_ENCRYPTION_KEY;if(!e)throw Error("FATAL: MASTER_ENCRYPTION_KEY environment variable is not set.");return u=new Uint8Array((0,s.scryptSync)(e,"salt",32))}function l(e){let t=c(),r=new Uint8Array((0,s.randomBytes)(16)),a=(0,s.createCipheriv)(o,t,r),i=a.update(e,"utf8","hex");return i+=a.final("hex"),`${Buffer.from(r).toString("hex")}:${i}`}function d(e){let t=c(),[r,a]=e.split(":");if(!r||!a)throw Error("Invalid hash format for decryption.");let i=new Uint8Array(Buffer.from(r,"hex")),n=(0,s.createDecipheriv)(o,t,i);return n.update(a,"hex","utf8")+n.final("utf8")}async function h(e){if(!e||e.length<8)throw Error("Password must be at least 8 characters long");return a.vp(e,12)}async function m(e,t){return!!e&&!!t&&a.qu(e,t)}async function p(e,t="24h"){let r=g();return await new i.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(t).sign(r)}async function f(e){let t=g();try{let{payload:r}=await n._(e,t);return r}catch(e){throw Error("Invalid or expired token")}}function g(){let e=process.env.JWT_SECRET;if(!e)throw Error("JWT_SECRET environment variable is not set");if(e.length<32)throw Error("JWT_SECRET must be at least 32 characters long");return new TextEncoder().encode(e)}function w(e=32){return(0,s.randomBytes)(e).toString("hex")}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[807,457],()=>r(8466));module.exports=s})();
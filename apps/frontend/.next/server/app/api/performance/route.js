"use strict";(()=>{var e={};e.id=996,e.ids=[996],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},9563:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},9064:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>M,originalPathname:()=>q,patchFetch:()=>v,requestAsyncStorage:()=>k,routeModule:()=>x,serverHooks:()=>S,staticGenerationAsyncStorage:()=>T,staticGenerationBailout:()=>R});var a={};r.r(a),r.d(a,{GET:()=>m});var o=r(5649),n=r(8584),s=r(5144),i=r(7180),u=r(1304),l=r(1376),c=r(2812),d=r(4793);let p=l.z.object({botId:l.z.string().uuid().optional(),botType:l.z.enum(["arbitrage","copy-trader","mev-sandwich"]).optional(),chain:l.z.enum(["ethereum","bsc","polygon","arbitrum","optimism","solana"]).optional(),period:l.z.enum(["1h","24h","7d","30d","90d","all"]).optional().default("7d"),granularity:l.z.enum(["hour","day","week"]).optional().default("day"),includeRiskMetrics:l.z.string().transform(e=>"true"===e).optional().default("true"),includeComparison:l.z.string().transform(e=>"true"===e).optional().default("false"),benchmarkType:l.z.enum(["hold","market","peer"]).optional().default("hold")});function h(e){let t=e.bot_configurations?.[0];return{status:String(e.status||""),profit_loss_usd:e.profit_loss_usd?String(e.profit_loss_usd):null,gas_fee_usd:e.gas_fee_usd?String(e.gas_fee_usd):null,amount_in:e.amount_in?String(e.amount_in):null,executed_at:String(e.executed_at||""),chain:e.chain?String(e.chain):void 0,token_in_symbol:e.token_in_symbol?String(e.token_in_symbol):void 0,token_out_symbol:e.token_out_symbol?String(e.token_out_symbol):void 0,trade_type:e.trade_type?String(e.trade_type):void 0,bot_configurations:t?{user_id:String(t.user_id||""),type:String(t.type||""),...t.name&&{name:String(t.name)}}:void 0}}async function m(e){try{let t=await c.qQ.check(e);if(!t.success)return i.Z.json({error:"Rate limit exceeded",retryAfter:Math.ceil((t.resetTime-Date.now())/1e3)},{status:429});let r=await (0,d.P)(e);if(!r.success)return i.Z.json({error:"Unauthorized",details:r.error},{status:401});let a=r.payload?.sub;if(!a)return i.Z.json({error:"Invalid token payload"},{status:401});let o=new URL(e.url),n=Object.fromEntries(o.searchParams.entries()),s=p.safeParse(n);if(!s.success)return i.Z.json({error:"Invalid query parameters",details:s.error.errors},{status:400});let{botId:u,botType:l,chain:h,period:m,granularity:w,includeRiskMetrics:x,includeComparison:k,benchmarkType:T}=s.data,S=function(e){let t;let r=new Date,a=r.toISOString();switch(e){case"1h":t=new Date(r.getTime()-36e5);break;case"24h":t=new Date(r.getTime()-864e5);break;case"7d":t=new Date(r.getTime()-6048e5);break;case"30d":t=new Date(r.getTime()-2592e6);break;case"90d":t=new Date(r.getTime()-7776e6);break;default:t=new Date(2023,0,1)}return{from:t.toISOString(),to:a}}(m),M=await f(a,{botId:u,botType:l,chain:h,dateRange:S}),R=await _(a,{botId:u,botType:l,chain:h,dateRange:S,granularity:w}),q=null;x&&(q=await g(a,{botId:u,botType:l,chain:h,dateRange:S}));let v=null;k&&(v=await b(a,{botId:u,botType:l,chain:h,dateRange:S,benchmarkType:T}));let I=await y(a,{botId:u,botType:l,chain:h,dateRange:S});return i.Z.json({success:!0,data:{period:{range:m,from:S.from,to:S.to,granularity:w},performance:M,timeSeries:R,riskMetrics:q,comparison:v,portfolio:I,filters:{botId:u,botType:l,chain:h}},timestamp:new Date().toISOString()})}catch(e){return console.error("API error:",e),i.Z.json({error:"Internal server error"},{status:500})}}async function f(e,t){try{let r,a=(function(){let e=process.env.SUPABASE_URL,t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase configuration is missing. Please set SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY environment variables.");return(0,u.eI)(e,t)})().from("trade_history").select(`
        status,
        profit_loss_usd,
        gas_fee_usd,
        amount_in,
        executed_at,
        chain,
        token_in_symbol,
        token_out_symbol,
        trade_type,
        bot_configurations!inner(user_id, type)
      `).eq("bot_configurations.user_id",e).gte("executed_at",t.dateRange.from).lte("executed_at",t.dateRange.to);t.botId&&(a=a.eq("bot_id",t.botId)),t.botType&&(a=a.eq("bot_configurations.type",t.botType)),t.chain&&(a=a.eq("chain",t.chain));let{data:o,error:n}=await a;if(n)return console.error("Trades query error:",n),null;let s=(o||[]).map(h),i=s.filter(e=>"completed"===e.status),l=s.filter(e=>"failed"===e.status),c=s.length,d=i.length,p=i.reduce((e,t)=>e+parseFloat(t.profit_loss_usd||"0"),0),m=s.reduce((e,t)=>e+parseFloat(t.gas_fee_usd||"0"),0),f=p-m,_=i.filter(e=>parseFloat(e.profit_loss_usd||"0")>0),g=i.length>0?_.length/i.length*100:0,b=i.length>0?p/i.length:0,y=i.length>0?i.reduce((e,t)=>e+parseFloat(t.amount_in||"0"),0)/i.length:0,x=Object.entries(w(i,e=>new Date(e.executed_at).toISOString().split("T")[0]||"unknown")).map(([e,t])=>({date:e,return:t.reduce((e,t)=>e+parseFloat(t.profit_loss_usd||"0"),0)}));return{summary:{totalTrades:c,successfulTrades:d,failedTrades:l.length,successRate:Math.round(100*(c>0?d/c*100:0))/100,winRate:Math.round(100*g)/100,totalProfitLoss:Math.round(100*p)/100,totalGasFees:Math.round(100*m)/100,netProfit:Math.round(100*f)/100,totalReturn:Math.round(f/Math.max(y*c,1)*1e4)/100,avgProfitPerTrade:Math.round(100*b)/100,avgTradeSize:Math.round(100*y)/100},returns:{daily:x,cumulative:(r=0,x.map(e=>(r+=e.return,{date:e.date,cumulativeReturn:r})))}}}catch(e){return console.error("Performance metrics calculation error:",e),null}}async function _(e,t){try{var r,a;let o=supabase.from("trade_history").select(`
        executed_at,
        profit_loss_usd,
        gas_fee_usd,
        status,
        bot_configurations!inner(user_id, type)
      `).eq("bot_configurations.user_id",e).gte("executed_at",t.dateRange.from).lte("executed_at",t.dateRange.to).order("executed_at",{ascending:!0});t.botId&&(o=o.eq("bot_id",t.botId)),t.botType&&(o=o.eq("bot_configurations.type",t.botType)),t.chain&&(o=o.eq("chain",t.chain));let{data:n,error:s}=await o;if(s||!n)return console.error("Time series query error:",s),[];let i=(r=n.map(h),a=t.granularity,r.reduce((e,t)=>{let r;let o=new Date(t.executed_at);switch(a){case"hour":r=o.toISOString().slice(0,13)+":00:00.000Z";break;case"week":let n=new Date(o);n.setDate(o.getDate()-o.getDay()),r=n.toISOString().split("T")[0]||"unknown";break;default:r=o.toISOString().split("T")[0]||"unknown"}return e[r]||(e[r]=[]),e[r].push(t),e},{}));return Object.entries(i).map(([e,t])=>{let r=t.filter(e=>"completed"===e.status),a=r.reduce((e,t)=>e+parseFloat(t.profit_loss_usd||"0"),0),o=t.reduce((e,t)=>e+parseFloat(t.gas_fee_usd||"0"),0),n=t.length>0?r.length/t.length*100:0;return{timestamp:e,totalTrades:t.length,completedTrades:r.length,totalProfit:Math.round(100*a)/100,totalGasFees:Math.round(100*o)/100,netProfit:Math.round(100*(a-o))/100,successRate:Math.round(100*n)/100}})}catch(e){return console.error("Time series data error:",e),[]}}async function g(e,t){try{let r=supabase.from("trade_history").select(`
        profit_loss_usd,
        executed_at,
        amount_in,
        bot_configurations!inner(user_id, type)
      `).eq("bot_configurations.user_id",e).eq("status","completed").gte("executed_at",t.dateRange.from).lte("executed_at",t.dateRange.to);t.botId&&(r=r.eq("bot_id",t.botId)),t.botType&&(r=r.eq("bot_configurations.type",t.botType)),t.chain&&(r=r.eq("chain",t.chain));let{data:a,error:o}=await r;if(o||!a||0===a.length)return null;let n=a.map(h).map(e=>parseFloat(e.profit_loss_usd||"0")),s=[...n].sort((e,t)=>e-t),i=n.reduce((e,t)=>e+t,0),u=i/n.length,l=n.reduce((e,t)=>e+Math.pow(t-u,2),0)/n.length,c=Math.sqrt(l),d=s[Math.floor(.05*n.length)]||0,p=function(e){let t=0,r=0,a=0;for(let o of e)a+=o,t=Math.max(t,((r=Math.max(r,a))-a)/Math.max(r,1));return-t}(n),m=u-.02/365,f=n.filter(e=>e<u),_=f.length>0?f.reduce((e,t)=>e+Math.pow(t-u,2),0)/f.length:0,g=Math.sqrt(_);return{volatility:Math.round(1e4*c)/1e4,var95:Math.round(100*d)/100,maxDrawdown:Math.round(100*p)/100,sharpeRatio:Math.round(1e3*(c>0?m/c:0))/1e3,sortinoRatio:Math.round(1e3*(g>0?m/g:0))/1e3,calmarRatio:Math.round(1e3*(Math.abs(p)>0?i/Math.abs(p):0))/1e3,avgReturn:Math.round(100*u)/100,totalReturn:Math.round(100*i)/100,bestTrade:Math.max(...n),worstTrade:Math.min(...n),winRate:n.filter(e=>e>0).length/n.length*100}}catch(e){return console.error("Risk metrics calculation error:",e),null}}async function b(e,t){try{let r=supabase.from("trade_history").select(`
        profit_loss_usd,
        executed_at,
        bot_configurations!inner(user_id, type)
      `).eq("bot_configurations.user_id",e).eq("status","completed").gte("executed_at",t.dateRange.from).lte("executed_at",t.dateRange.to),{data:a}=await r;if(!a||0===a.length)return null;let o=a.map(e=>parseFloat(e.profit_loss_usd||"0")),n=o.reduce((e,t)=>e+t,0),s=n/o.length;return{benchmark:{type:t.benchmarkType,return:5.2,volatility:15.5,sharpeRatio:.34},user:{return:n,avgReturn:s,trades:a.length},relative:{excessReturn:n-5.2,informationRatio:.18,beta:.85,alpha:1.2}}}catch(e){return console.error("Comparison data error:",e),null}}async function y(e,t){try{let r=supabase.from("trade_history").select(`
        chain,
        token_in_symbol,
        token_out_symbol,
        profit_loss_usd,
        gas_fee_usd,
        amount_in,
        trade_type,
        status,
        executed_at,
        bot_configurations!inner(user_id, type, name)
      `).eq("bot_configurations.user_id",e).eq("status","completed").gte("executed_at",t.dateRange.from).lte("executed_at",t.dateRange.to);t.botId&&(r=r.eq("bot_id",t.botId)),t.botType&&(r=r.eq("bot_configurations.type",t.botType)),t.chain&&(r=r.eq("chain",t.chain));let{data:a,error:o}=await r;if(o||!a)return null;let n=a.map(h),s=w(n,"chain"),i=w(n,e=>e.bot_configurations?.name||"Unknown"),u=w(n,"trade_type"),l=w(n,"token_in_symbol"),c=e=>({trades:e.length,totalProfit:e.reduce((e,t)=>e+parseFloat(t.profit_loss_usd||"0"),0),avgTradeSize:e.reduce((e,t)=>e+parseFloat(t.amount_in||"0"),0)/e.length});return{byChain:Object.fromEntries(Object.entries(s).map(([e,t])=>[e,c(t)])),byBot:Object.fromEntries(Object.entries(i).map(([e,t])=>[e,c(t)])),byTradeType:Object.fromEntries(Object.entries(u).map(([e,t])=>[e,c(t)])),byToken:Object.fromEntries(Object.entries(l).slice(0,10).map(([e,t])=>[e,c(t)]))}}catch(e){return console.error("Portfolio breakdown error:",e),null}}function w(e,t){return e.reduce((e,r)=>{let a;if("string"==typeof t){let e=r[t];a=e?String(e):"unknown"}else a=t(r)??"unknown";return e[a]||(e[a]=[]),e[a].push(r),e},{})}let x=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/performance/route",pathname:"/api/performance",filename:"route",bundlePath:"app/api/performance/route"},resolvedPagePath:"C:\\Users\\User1\\Downloads\\TradingBot\\apps\\frontend\\src\\app\\api\\performance\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:k,staticGenerationAsyncStorage:T,serverHooks:S,headerHooks:M,staticGenerationBailout:R}=x,q="/api/performance/route";function v(){return(0,s.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:T})}},4793:(e,t,r)=>{r.d(t,{P:()=>a});async function a(e){try{let t=e.cookies.get("auth_token")?.value;if(!t){let r=e.headers.get("authorization");r&&r.startsWith("Bearer ")&&(t=r.substring(7))}if(!t)return{success:!1,error:"No token provided"};if("mock_jwt_token"===t)return{success:!0,payload:{sub:"user-123",email:"test@example.com",iat:Math.floor(Date.now()/1e3),exp:Math.floor(Date.now()/1e3)+86400}};let r=process.env.JWT_SECRET||"default-secret-for-development",a=function(e,t){if(!t||t.length<8)throw Error("Invalid or weak secret");if("mock_jwt_token"===e)return{sub:"user-123",email:"test@example.com",iat:Math.floor(Date.now()/1e3),exp:Math.floor(Date.now()/1e3)+86400};throw Error("Invalid token")}(t,r);return{success:!0,payload:a}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Invalid token"}}}},2812:(e,t,r)=>{r.d(t,{qQ:()=>o});class a{constructor(e=100,t=9e5){this.store={},this.defaultLimit=e,this.defaultWindow=t,setInterval(()=>{this.cleanup()},3e5)}async check(e,t=this.defaultLimit,r=this.defaultWindow){let a=this.getIdentifier(e),o=Date.now(),n=`${a}:${Math.floor(o/r)}`;this.store[n]||(this.store[n]={count:0,resetTime:o+r});let s=this.store[n];return s.count>=t?{success:!1,remaining:0,resetTime:s.resetTime,error:`Rate limit exceeded. Try again in ${Math.ceil((s.resetTime-o)/1e3)} seconds.`}:(s.count++,{success:!0,remaining:t-s.count,resetTime:s.resetTime})}getIdentifier(e){let t=e.headers.get("x-user-id");if(t)return`user:${t}`;let r=e.headers.get("x-forwarded-for"),a=e.headers.get("x-real-ip"),o=r?r.split(",")[0]?.trim():a||"unknown";return`ip:${o}`}cleanup(){let e=Date.now();Object.keys(this.store).forEach(t=>{let r=this.store[t];r&&r.resetTime<e&&delete this.store[t]})}async checkLimit(e,t="default"){let r="action"===t?10:this.defaultLimit,a=await this.check(e,r);return a.success?{allowed:!0}:{allowed:!1,retryAfter:Math.ceil((a.resetTime-Date.now())/1e3)}}getStatus(e){let t=this.getIdentifier(e),r=Date.now(),a=`${t}:${Math.floor(r/this.defaultWindow)}`,o=this.store[a];return o?{count:o.count,remaining:Math.max(0,this.defaultLimit-o.count),resetTime:o.resetTime}:{count:0,remaining:this.defaultLimit,resetTime:r+this.defaultWindow}}}let o=new a;function n(e=100,t=9e5){return async r=>{let a=await o.check(r,e,t);return{...a,headers:{"X-RateLimit-Limit":e.toString(),"X-RateLimit-Remaining":a.remaining.toString(),"X-RateLimit-Reset":Math.ceil(a.resetTime/1e3).toString()}}}}n(5,9e5),n(100,9e5),n(50,6e4)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[807,309,717],()=>r(9064));module.exports=a})();